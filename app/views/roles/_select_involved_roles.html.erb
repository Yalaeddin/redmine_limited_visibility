<script>
  $(function() {
    $('.role').on('click', function() {
      if (!$(this).hasClass('disabled')){
        $(this).toggleClass('involved');
        var authorized = [];
        $('.role.involved').each(function() {
          authorized.push($(this).data('filter'))
        });
        $('#role_authorized_viewers').val('|' + authorized.join('|') + '|');
        $('#issue_authorized_viewers').val('|' + authorized.join('|') + '|');
      }
    })
  });
</script>

<p id=involved-roles class=involved-roles>
  <label><%= l(:label_involved_members) %> : </label>
  <% Role.find_all_visibility_roles.each do |role| %>
    <% role_is_involved = viewers.split('|').include?(role.id.to_s) %>
    <span class="role <%= @role==role || (@current_roles && @current_roles.include?(role) && role_is_involved) ? "involved disabled" : (role_is_involved ? 'involved' : '') %>" data-filter="<%= role.id %>">
      <span class=status-icon><i class=fa-icon-ok></i><i class=fa-icon-remove></i></span>
      <%= role.name %>
      <i class=fa-icon-lock></i>
    </span>
  <% end %>
</p>

<%= hidden_field_tag "role[authorized_viewers]", "#{viewers}" %>
<%= hidden_field_tag "issue[authorized_viewers]", "#{viewers}" %>
